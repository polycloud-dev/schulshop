"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/checkout/update/[id]";
exports.ids = ["pages/api/checkout/update/[id]"];
exports.modules = {

/***/ "biguint-format":
/*!*********************************!*\
  !*** external "biguint-format" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("biguint-format");

/***/ }),

/***/ "flake-idgen":
/*!******************************!*\
  !*** external "flake-idgen" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("flake-idgen");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

module.exports = require("redis");

/***/ }),

/***/ "./backend/apiError.js":
/*!*****************************!*\
  !*** ./backend/apiError.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ ApiError)\n/* harmony export */ });\nclass ApiError extends Error {\n    constructor(msg, status = 400){\n        super(msg);\n        this.msg = msg;\n        this.status = status;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9iYWNrZW5kL2FwaUVycm9yLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBZSxNQUFNQSxRQUFRLFNBQVNDLEtBQUs7Z0JBQzNCQyxHQUFHLEVBQUVDLE1BQU0sR0FBQyxHQUFHLENBQUUsQ0FBQztRQUMxQixLQUFLLENBQUNELEdBQUc7UUFDVCxJQUFJLENBQUNBLEdBQUcsR0FBR0EsR0FBRztRQUNkLElBQUksQ0FBQ0MsTUFBTSxHQUFHQSxNQUFNO0lBQ3hCLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zY2h1bHNob3AvLi9iYWNrZW5kL2FwaUVycm9yLmpzPzM5MWEiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihtc2csIHN0YXR1cz00MDApIHtcclxuICAgICAgICBzdXBlcihtc2cpO1xyXG4gICAgICAgIHRoaXMubXNnID0gbXNnO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgfVxyXG59Il0sIm5hbWVzIjpbIkFwaUVycm9yIiwiRXJyb3IiLCJtc2ciLCJzdGF0dXMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./backend/apiError.js\n");

/***/ }),

/***/ "./backend/logger.js":
/*!***************************!*\
  !*** ./backend/logger.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ LogClient)\n/* harmony export */ });\nclass LogClient {\n    constructor(name){\n        this.name = name;\n    }\n    static register(name) {\n        return new LogClient(name);\n    }\n    log(msg) {\n        const now = new Date();\n        console.log(`[\\x1b[36m${now.getDate()}.${now.getMonth()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}\\x1b[0m] [\\x1b[32m${this.name}\\x1b[0m] ${msg}`);\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9iYWNrZW5kL2xvZ2dlci5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQWUsTUFBTUEsU0FBUztnQkFDZEMsSUFBSSxDQUFFLENBQUM7UUFDZixJQUFJLENBQUNBLElBQUksR0FBR0EsSUFBSTtJQUNwQixDQUFDO1dBQ01DLFFBQVEsQ0FBQ0QsSUFBSSxFQUFFLENBQUM7UUFDbkIsTUFBTSxDQUFDLEdBQUcsQ0FBQ0QsU0FBUyxDQUFDQyxJQUFJO0lBQzdCLENBQUM7SUFDREUsR0FBRyxDQUFDQyxHQUFHLEVBQUUsQ0FBQztRQUNOLEtBQUssQ0FBQ0MsR0FBRyxHQUFHLEdBQUcsQ0FBQ0MsSUFBSTtRQUNwQkMsT0FBTyxDQUFDSixHQUFHLEVBQUUsU0FBUyxFQUFFRSxHQUFHLENBQUNHLE9BQU8sR0FBRyxDQUFDLEVBQUVILEdBQUcsQ0FBQ0ksUUFBUSxHQUFHLENBQUMsRUFBRUosR0FBRyxDQUFDSyxRQUFRLEdBQUcsQ0FBQyxFQUFFTCxHQUFHLENBQUNNLFVBQVUsR0FBRyxDQUFDLEVBQUVOLEdBQUcsQ0FBQ08sVUFBVSxHQUFHLGtCQUFrQixFQUFFLElBQUksQ0FBQ1gsSUFBSSxDQUFDLFNBQVMsRUFBRUcsR0FBRztJQUNsSyxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2NodWxzaG9wLy4vYmFja2VuZC9sb2dnZXIuanM/MmYwZCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dDbGllbnQge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSkge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWVcclxuICAgIH1cclxuICAgIHN0YXRpYyByZWdpc3RlcihuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMb2dDbGllbnQobmFtZSlcclxuICAgIH1cclxuICAgIGxvZyhtc2cpIHtcclxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBbXFx4MWJbMzZtJHtub3cuZ2V0RGF0ZSgpfS4ke25vdy5nZXRNb250aCgpfSAke25vdy5nZXRIb3VycygpfToke25vdy5nZXRNaW51dGVzKCl9OiR7bm93LmdldFNlY29uZHMoKX1cXHgxYlswbV0gW1xceDFiWzMybSR7dGhpcy5uYW1lfVxceDFiWzBtXSAke21zZ31gKTtcclxuICAgIH1cclxufSJdLCJuYW1lcyI6WyJMb2dDbGllbnQiLCJuYW1lIiwicmVnaXN0ZXIiLCJsb2ciLCJtc2ciLCJub3ciLCJEYXRlIiwiY29uc29sZSIsImdldERhdGUiLCJnZXRNb250aCIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./backend/logger.js\n");

/***/ }),

/***/ "./backend/sessions.js":
/*!*****************************!*\
  !*** ./backend/sessions.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"redis\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var biguint_format__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! biguint-format */ \"biguint-format\");\n/* harmony import */ var biguint_format__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(biguint_format__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var flake_idgen__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! flake-idgen */ \"flake-idgen\");\n/* harmony import */ var flake_idgen__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(flake_idgen__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _apiError__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./apiError */ \"./backend/apiError.js\");\n/* harmony import */ var _backend_logger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../backend/logger */ \"./backend/logger.js\");\n\n\n\n\n\nconst logClient = _backend_logger__WEBPACK_IMPORTED_MODULE_4__[\"default\"].register('SessionManager');\nconst flake = new (flake_idgen__WEBPACK_IMPORTED_MODULE_2___default())();\nconst production = process.env['PRODUCTION'] === 'TRUE';\nfunction connectClient() {\n    return new Promise(async (resolve)=>{\n        const client = production ? (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)({\n            \"url\": \"redis://redis:6379\"\n        }) : (0,redis__WEBPACK_IMPORTED_MODULE_0__.createClient)();\n        client.on('error', (err)=>{\n            logClient.log('Failed to connect to redis!');\n        });\n        client.on('ready', ()=>{\n            resolve(client);\n        });\n        await client.connect();\n    });\n}\nconnectClient();\nfunction findAllSessions() {\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const result = [];\n        for await (const key1 of client.scanIterator()){\n            const value = await client.get(key1);\n            if (value.type === 'session') result.push(value);\n        }\n        resolve(result);\n    });\n}\nfunction removeSession(id) {\n    if (!id) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no ID given!\");\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const value = await client.get(id);\n        await client.del(id);\n        await client.del(key(JSON.parse(value).ip));\n        logClient.log(`Deleted Session ${id}!`);\n        resolve();\n    });\n}\nfunction setSessionState(id, state) {\n    if (!id) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no ID given!\");\n    if (state !== 'pending' || state !== 'completed' || state !== 'canceled') return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](`unknown state '${state}'!`);\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const value = await client.get(id);\n        const previous = value.state;\n        value.state = state;\n        var date = new Date();\n        date.setHours(date.getHours() + 1);\n        value.expireIn = date;\n        await client.set(id, value);\n        logClient.log(`Session state of ${id} changed from '${previous}' to '${state}'!`);\n        resolve();\n    });\n}\nfunction updateSession(id, products) {\n    if (!id) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no ID given!\");\n    if (!products) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no products given!\");\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const res = await client.get(id);\n        if (!res) return resolve(new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"session not found!\"));\n        const value = JSON.parse(res);\n        value.products = products;\n        var date = new Date();\n        date.setHours(date.getHours() + 1);\n        value.expireIn = date;\n        await client.set(id, JSON.stringify(value));\n        logClient.log(`Changed products of Session ${id}!`);\n        resolve();\n    });\n}\nfunction createSession(ip) {\n    if (!ip) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no IP given!\");\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const ipDataRaw = await client.get(key(ip));\n        if (ipDataRaw) {\n            const ipData = JSON.parse(ipDataRaw);\n            const session = await client.get(ipData.sessionId);\n            if (session) {\n                logClient.log(`User '${ipData.username}' connected to session ${ipData.sessionId}!`);\n                return resolve({\n                    \"sessionId\": ipData.sessionId\n                });\n            }\n        }\n        const sessionId = biguint_format__WEBPACK_IMPORTED_MODULE_1___default()(flake.next(), 'dec');\n        const now = new Date();\n        const expired = new Date();\n        expired.setHours(expired.getHours() + 1);\n        await client.set(sessionId, JSON.stringify({\n            \"created\": now,\n            \"expireIn\": expired,\n            \"ip\": ip,\n            \"state\": \"pending\",\n            \"products\": [],\n            \"type\": \"session\"\n        }));\n        await client.set(key(ip), JSON.stringify({\n            \"sessionId\": sessionId,\n            \"type\": \"user\",\n            \"username\": key(ip)\n        }));\n        logClient.log(`Session created by ${key(ip)}. ID: ${sessionId}`);\n        resolve({\n            \"sessionId\": sessionId,\n            \"type\": \"user\",\n            \"username\": key(ip)\n        });\n    });\n}\nfunction findAll() {\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const result = [];\n        for await (const key2 of client.scanIterator()){\n            const clientData = await client.get(key2);\n            const value = JSON.parse(clientData);\n            value.id = key2;\n            result.push(value);\n        }\n        resolve(result);\n    });\n}\nfunction collectExpiredSessions() {\n    return new Promise(async (resolve)=>{\n        logClient.log('Collect expired sessions!');\n        const entries = await findAll();\n        const now = new Date().getTime();\n        await entries.forEach(async (entry)=>{\n            const expireIn = Date.parse(entry.expireIn);\n            if (entry.type === 'session' && (isNaN(expireIn) || now >= Date.parse(entry.expireIn))) await removeSession(entry.id);\n        });\n        resolve();\n    });\n}\nfunction getSession(id) {\n    if (!id) return new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"no ID given!\");\n    return new Promise(async (resolve)=>{\n        const client = await connectClient();\n        const value = await client.get(id);\n        if (!value) return resolve(new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"](\"session not found!\"));\n        resolve(JSON.parse(value));\n    });\n}\nfunction key(ip) {\n    return `ip${ip.replaceAll('.', '').replaceAll(':', '')}`;\n}\nconst sessions = {\n    \"connect\": connectClient,\n    \"create\": createSession,\n    \"findAll\": findAllSessions,\n    \"setState\": setSessionState,\n    \"kill\": removeSession,\n    \"collectExpired\": collectExpiredSessions,\n    \"update\": updateSession,\n    \"get\": getSession,\n    \"timedTask\": class {\n        constructor(task, time = 5000){\n            this.task = task;\n            this.time = time;\n        }\n        start() {\n            return new Promise(async (resolve)=>{\n                this.worker = setTimeout(()=>{\n                    clearTimeout(this.worker);\n                    resolve(new _apiError__WEBPACK_IMPORTED_MODULE_3__[\"default\"]('Timed out!', 504));\n                }, this.time);\n                const taskResult = await this.task();\n                resolve(taskResult);\n            });\n        }\n    }\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (sessions);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YTtJQUN2QixDQUFTLFVBQUUzQixlQUFlO0lBQzFCLENBQVUsV0FBRWMsZUFBZTtJQUMzQixDQUFNLE9BQUVOLGFBQWE7SUFDckIsQ0FBZ0IsaUJBQUU4QixzQkFBc0I7SUFDeEMsQ0FBUSxTQUFFZixhQUFhO0lBQ3ZCLENBQUssTUFBRXFCLFVBQVU7SUFDakIsQ0FBVztvQkFDS0csSUFBSSxFQUFFQyxJQUFJLEdBQUMsSUFBSSxDQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDRCxJQUFJLEdBQUdBLElBQUk7WUFDaEIsSUFBSSxDQUFDQyxJQUFJLEdBQUdBLElBQUk7UUFDcEIsQ0FBQztRQUNEQyxLQUFLLEdBQUcsQ0FBQztZQUNMLE1BQU0sQ0FBQyxHQUFHLENBQUN4RCxPQUFPLFFBQU9DLE9BQU8sR0FBSSxDQUFDO2dCQUNqQyxJQUFJLENBQUN3RCxNQUFNLEdBQUdDLFVBQVUsS0FBTyxDQUFDO29CQUM1QkMsWUFBWSxDQUFDLElBQUksQ0FBQ0YsTUFBTTtvQkFDeEJ4RCxPQUFPLENBQUMsR0FBRyxDQUFDVixpREFBUSxDQUFDLENBQVksYUFBRSxHQUFHO2dCQUMxQyxDQUFDLEVBQUUsSUFBSSxDQUFDZ0UsSUFBSTtnQkFDWixLQUFLLENBQUNLLFVBQVUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDTixJQUFJO2dCQUNsQ3JELE9BQU8sQ0FBQzJELFVBQVU7WUFDdEIsQ0FBQztRQUNMLENBQUM7O0FBRVQsQ0FBQztBQUNELGlFQUFlUCxRQUFRLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zY2h1bHNob3AvLi9iYWNrZW5kL3Nlc3Npb25zLmpzPzFlNmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtjcmVhdGVDbGllbnR9IGZyb20gJ3JlZGlzJztcclxuXHJcbmltcG9ydCBpbnRmb3JtYXQgZnJvbSAnYmlndWludC1mb3JtYXQnO1xyXG5pbXBvcnQgRmxha2VJZCBmcm9tICdmbGFrZS1pZGdlbic7XHJcblxyXG5pbXBvcnQgQXBpRXJyb3IgZnJvbSAnLi9hcGlFcnJvcic7XHJcblxyXG5pbXBvcnQgTG9nQ2xpZW50IGZyb20gJy4uL2JhY2tlbmQvbG9nZ2VyJ1xyXG5jb25zdCBsb2dDbGllbnQgPSBMb2dDbGllbnQucmVnaXN0ZXIoJ1Nlc3Npb25NYW5hZ2VyJyk7XHJcblxyXG5jb25zdCBmbGFrZSA9IG5ldyBGbGFrZUlkKCk7XHJcblxyXG5jb25zdCBwcm9kdWN0aW9uID0gcHJvY2Vzcy5lbnZbJ1BST0RVQ1RJT04nXSA9PT0gJ1RSVUUnO1xyXG5cclxuZnVuY3Rpb24gY29ubmVjdENsaWVudCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyByZXNvbHZlID0+IHtcclxuICAgICAgICBjb25zdCBjbGllbnQgPSBwcm9kdWN0aW9uID8gY3JlYXRlQ2xpZW50KHtcInVybFwiOiBcInJlZGlzOi8vcmVkaXM6NjM3OVwifSkgOiBjcmVhdGVDbGllbnQoKTtcclxuICAgICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICAgICAgICBsb2dDbGllbnQubG9nKCdGYWlsZWQgdG8gY29ubmVjdCB0byByZWRpcyEnKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjbGllbnQub24oJ3JlYWR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICByZXNvbHZlKGNsaWVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXdhaXQgY2xpZW50LmNvbm5lY3QoKTtcclxuICAgIH0pXHJcbn1cclxuY29ubmVjdENsaWVudCgpXHJcblxyXG5mdW5jdGlvbiBmaW5kQWxsU2Vzc2lvbnMoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgcmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY29ubmVjdENsaWVudCgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdXHJcbiAgICAgICAgZm9yIGF3YWl0KGNvbnN0IGtleSBvZiBjbGllbnQuc2Nhbkl0ZXJhdG9yKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBjbGllbnQuZ2V0KGtleSlcclxuICAgICAgICAgICAgaWYodmFsdWUudHlwZSA9PT0gJ3Nlc3Npb24nKSByZXN1bHQucHVzaCh2YWx1ZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQpXHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVTZXNzaW9uKGlkKSB7XHJcbiAgICBpZighaWQpIHJldHVybiBuZXcgQXBpRXJyb3IoXCJubyBJRCBnaXZlbiFcIilcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyByZXNvbHZlID0+IHtcclxuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjb25uZWN0Q2xpZW50KCk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBjbGllbnQuZ2V0KGlkKVxyXG4gICAgICAgIGF3YWl0IGNsaWVudC5kZWwoaWQpXHJcbiAgICAgICAgYXdhaXQgY2xpZW50LmRlbChrZXkoSlNPTi5wYXJzZSh2YWx1ZSkuaXApKVxyXG4gICAgICAgIGxvZ0NsaWVudC5sb2coYERlbGV0ZWQgU2Vzc2lvbiAke2lkfSFgKTtcclxuICAgICAgICByZXNvbHZlKClcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFNlc3Npb25TdGF0ZShpZCwgc3RhdGUpIHtcclxuICAgIGlmKCFpZCkgcmV0dXJuIG5ldyBBcGlFcnJvcihcIm5vIElEIGdpdmVuIVwiKVxyXG4gICAgaWYoc3RhdGUgIT09ICdwZW5kaW5nJyB8fCBzdGF0ZSAhPT0gJ2NvbXBsZXRlZCcgfHwgc3RhdGUgIT09ICdjYW5jZWxlZCcpIHJldHVybiBuZXcgQXBpRXJyb3IoYHVua25vd24gc3RhdGUgJyR7c3RhdGV9JyFgKVxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIHJlc29sdmUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNvbm5lY3RDbGllbnQoKTtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IGNsaWVudC5nZXQoaWQpO1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzID0gdmFsdWUuc3RhdGVcclxuICAgICAgICB2YWx1ZS5zdGF0ZSA9IHN0YXRlO1xyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBkYXRlLnNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSArIDEpXHJcbiAgICAgICAgdmFsdWUuZXhwaXJlSW4gPSBkYXRlO1xyXG4gICAgICAgIGF3YWl0IGNsaWVudC5zZXQoaWQsIHZhbHVlKTtcclxuICAgICAgICBsb2dDbGllbnQubG9nKGBTZXNzaW9uIHN0YXRlIG9mICR7aWR9IGNoYW5nZWQgZnJvbSAnJHtwcmV2aW91c30nIHRvICcke3N0YXRlfSchYCk7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlU2Vzc2lvbihpZCwgcHJvZHVjdHMpIHtcclxuICAgIGlmKCFpZCkgcmV0dXJuIG5ldyBBcGlFcnJvcihcIm5vIElEIGdpdmVuIVwiKVxyXG4gICAgaWYoIXByb2R1Y3RzKSByZXR1cm4gbmV3IEFwaUVycm9yKFwibm8gcHJvZHVjdHMgZ2l2ZW4hXCIpXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgcmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY29ubmVjdENsaWVudCgpO1xyXG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNsaWVudC5nZXQoaWQpO1xyXG4gICAgICAgIGlmKCFyZXMpIHJldHVybiByZXNvbHZlKG5ldyBBcGlFcnJvcihcInNlc3Npb24gbm90IGZvdW5kIVwiKSlcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IEpTT04ucGFyc2UocmVzKTtcclxuICAgICAgICB2YWx1ZS5wcm9kdWN0cyA9IHByb2R1Y3RzO1xyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBkYXRlLnNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSArIDEpXHJcbiAgICAgICAgdmFsdWUuZXhwaXJlSW4gPSBkYXRlO1xyXG4gICAgICAgIGF3YWl0IGNsaWVudC5zZXQoaWQsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgbG9nQ2xpZW50LmxvZyhgQ2hhbmdlZCBwcm9kdWN0cyBvZiBTZXNzaW9uICR7aWR9IWApO1xyXG4gICAgICAgIHJlc29sdmUoKTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVNlc3Npb24oaXApIHtcclxuICAgIGlmKCFpcCkgcmV0dXJuIG5ldyBBcGlFcnJvcihcIm5vIElQIGdpdmVuIVwiKVxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIHJlc29sdmUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNvbm5lY3RDbGllbnQoKTtcclxuICAgICAgICBjb25zdCBpcERhdGFSYXcgPSBhd2FpdCBjbGllbnQuZ2V0KGtleShpcCkpO1xyXG4gICAgICAgIGlmKGlwRGF0YVJhdykge1xyXG4gICAgICAgICAgICBjb25zdCBpcERhdGEgPSBKU09OLnBhcnNlKGlwRGF0YVJhdyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBjbGllbnQuZ2V0KGlwRGF0YS5zZXNzaW9uSWQpO1xyXG4gICAgICAgICAgICBpZihzZXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dDbGllbnQubG9nKGBVc2VyICcke2lwRGF0YS51c2VybmFtZX0nIGNvbm5lY3RlZCB0byBzZXNzaW9uICR7aXBEYXRhLnNlc3Npb25JZH0hYClcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHtcInNlc3Npb25JZFwiOiBpcERhdGEuc2Vzc2lvbklkfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSBpbnRmb3JtYXQoZmxha2UubmV4dCgpLCAnZGVjJyk7XHJcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxyXG4gICAgICAgIGNvbnN0IGV4cGlyZWQgPSBuZXcgRGF0ZSgpXHJcbiAgICAgICAgZXhwaXJlZC5zZXRIb3VycyhleHBpcmVkLmdldEhvdXJzKCkgKyAxKVxyXG4gICAgICAgIGF3YWl0IGNsaWVudC5zZXQoc2Vzc2lvbklkLCBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIFwiY3JlYXRlZFwiOiBub3csXHJcbiAgICAgICAgICAgIFwiZXhwaXJlSW5cIjogZXhwaXJlZCxcclxuICAgICAgICAgICAgXCJpcFwiOiBpcCxcclxuICAgICAgICAgICAgXCJzdGF0ZVwiOiBcInBlbmRpbmdcIixcclxuICAgICAgICAgICAgXCJwcm9kdWN0c1wiOiBbXSxcclxuICAgICAgICAgICAgXCJ0eXBlXCI6IFwic2Vzc2lvblwiXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGF3YWl0IGNsaWVudC5zZXQoa2V5KGlwKSwgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICBcInNlc3Npb25JZFwiOiBzZXNzaW9uSWQsXHJcbiAgICAgICAgICAgIFwidHlwZVwiOiBcInVzZXJcIixcclxuICAgICAgICAgICAgXCJ1c2VybmFtZVwiOiBrZXkoaXApXHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIGxvZ0NsaWVudC5sb2coYFNlc3Npb24gY3JlYXRlZCBieSAke2tleShpcCl9LiBJRDogJHtzZXNzaW9uSWR9YCk7XHJcbiAgICAgICAgcmVzb2x2ZSh7XHJcbiAgICAgICAgICAgIFwic2Vzc2lvbklkXCI6IHNlc3Npb25JZCxcclxuICAgICAgICAgICAgXCJ0eXBlXCI6IFwidXNlclwiLFxyXG4gICAgICAgICAgICBcInVzZXJuYW1lXCI6IGtleShpcClcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gZmluZEFsbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyByZXNvbHZlID0+IHtcclxuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjb25uZWN0Q2xpZW50KCk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW11cclxuICAgICAgICBmb3IgYXdhaXQoY29uc3Qga2V5IG9mIGNsaWVudC5zY2FuSXRlcmF0b3IoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBjbGllbnREYXRhID0gYXdhaXQgY2xpZW50LmdldChrZXkpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IEpTT04ucGFyc2UoY2xpZW50RGF0YSk7XHJcbiAgICAgICAgICAgIHZhbHVlLmlkID0ga2V5O1xyXG4gICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbGxlY3RFeHBpcmVkU2Vzc2lvbnMoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgcmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgbG9nQ2xpZW50LmxvZygnQ29sbGVjdCBleHBpcmVkIHNlc3Npb25zIScpO1xyXG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBmaW5kQWxsKClcclxuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICBhd2FpdCBlbnRyaWVzLmZvckVhY2goYXN5bmMgZW50cnkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBleHBpcmVJbiA9IERhdGUucGFyc2UoZW50cnkuZXhwaXJlSW4pO1xyXG4gICAgICAgICAgICBpZihlbnRyeS50eXBlID09PSAnc2Vzc2lvbicgJiYgKGlzTmFOKGV4cGlyZUluKSB8fCBub3cgPj0gRGF0ZS5wYXJzZShlbnRyeS5leHBpcmVJbikpKSBhd2FpdCByZW1vdmVTZXNzaW9uKGVudHJ5LmlkKTsgXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U2Vzc2lvbihpZCkge1xyXG4gICAgaWYoIWlkKSByZXR1cm4gbmV3IEFwaUVycm9yKFwibm8gSUQgZ2l2ZW4hXCIpXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgcmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY29ubmVjdENsaWVudCgpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgY2xpZW50LmdldChpZCk7XHJcbiAgICAgICAgaWYoIXZhbHVlKSByZXR1cm4gcmVzb2x2ZShuZXcgQXBpRXJyb3IoXCJzZXNzaW9uIG5vdCBmb3VuZCFcIikpXHJcbiAgICAgICAgcmVzb2x2ZShKU09OLnBhcnNlKHZhbHVlKSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBrZXkoaXApIHtcclxuICAgIHJldHVybiBgaXAke2lwLnJlcGxhY2VBbGwoJy4nLCAnJykucmVwbGFjZUFsbCgnOicsICcnKX1gXHJcbn1cclxuXHJcbmNvbnN0IHNlc3Npb25zID0ge1xyXG4gICAgXCJjb25uZWN0XCI6IGNvbm5lY3RDbGllbnQsXHJcbiAgICBcImNyZWF0ZVwiOiBjcmVhdGVTZXNzaW9uLFxyXG4gICAgXCJmaW5kQWxsXCI6IGZpbmRBbGxTZXNzaW9ucyxcclxuICAgIFwic2V0U3RhdGVcIjogc2V0U2Vzc2lvblN0YXRlLFxyXG4gICAgXCJraWxsXCI6IHJlbW92ZVNlc3Npb24sXHJcbiAgICBcImNvbGxlY3RFeHBpcmVkXCI6IGNvbGxlY3RFeHBpcmVkU2Vzc2lvbnMsXHJcbiAgICBcInVwZGF0ZVwiOiB1cGRhdGVTZXNzaW9uLFxyXG4gICAgXCJnZXRcIjogZ2V0U2Vzc2lvbixcclxuICAgIFwidGltZWRUYXNrXCI6IGNsYXNzIHtcclxuICAgICAgICBjb25zdHJ1Y3Rvcih0YXNrLCB0aW1lPTUwMDApIHtcclxuICAgICAgICAgICAgdGhpcy50YXNrID0gdGFzaztcclxuICAgICAgICAgICAgdGhpcy50aW1lID0gdGltZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RhcnQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyByZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMud29ya2VyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMud29ya2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IEFwaUVycm9yKCdUaW1lZCBvdXQhJywgNTA0KSlcclxuICAgICAgICAgICAgICAgIH0sIHRoaXMudGltZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0YXNrUmVzdWx0ID0gYXdhaXQgdGhpcy50YXNrKClcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodGFza1Jlc3VsdClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9IFxyXG59XHJcbmV4cG9ydCBkZWZhdWx0IHNlc3Npb25zOyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJpbnRmb3JtYXQiLCJGbGFrZUlkIiwiQXBpRXJyb3IiLCJMb2dDbGllbnQiLCJsb2dDbGllbnQiLCJyZWdpc3RlciIsImZsYWtlIiwicHJvZHVjdGlvbiIsInByb2Nlc3MiLCJlbnYiLCJjb25uZWN0Q2xpZW50IiwiUHJvbWlzZSIsInJlc29sdmUiLCJjbGllbnQiLCJvbiIsImVyciIsImxvZyIsImNvbm5lY3QiLCJmaW5kQWxsU2Vzc2lvbnMiLCJyZXN1bHQiLCJrZXkiLCJzY2FuSXRlcmF0b3IiLCJ2YWx1ZSIsImdldCIsInR5cGUiLCJwdXNoIiwicmVtb3ZlU2Vzc2lvbiIsImlkIiwiZGVsIiwiSlNPTiIsInBhcnNlIiwiaXAiLCJzZXRTZXNzaW9uU3RhdGUiLCJzdGF0ZSIsInByZXZpb3VzIiwiZGF0ZSIsIkRhdGUiLCJzZXRIb3VycyIsImdldEhvdXJzIiwiZXhwaXJlSW4iLCJzZXQiLCJ1cGRhdGVTZXNzaW9uIiwicHJvZHVjdHMiLCJyZXMiLCJzdHJpbmdpZnkiLCJjcmVhdGVTZXNzaW9uIiwiaXBEYXRhUmF3IiwiaXBEYXRhIiwic2Vzc2lvbiIsInNlc3Npb25JZCIsInVzZXJuYW1lIiwibmV4dCIsIm5vdyIsImV4cGlyZWQiLCJmaW5kQWxsIiwiY2xpZW50RGF0YSIsImNvbGxlY3RFeHBpcmVkU2Vzc2lvbnMiLCJlbnRyaWVzIiwiZ2V0VGltZSIsImZvckVhY2giLCJlbnRyeSIsImlzTmFOIiwiZ2V0U2Vzc2lvbiIsInJlcGxhY2VBbGwiLCJzZXNzaW9ucyIsInRhc2siLCJ0aW1lIiwic3RhcnQiLCJ3b3JrZXIiLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwidGFza1Jlc3VsdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./backend/sessions.js\n");

/***/ }),

/***/ "./pages/api/checkout/update/[id].js":
/*!*******************************************!*\
  !*** ./pages/api/checkout/update/[id].js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _backend_sessions__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../backend/sessions */ \"./backend/sessions.js\");\n\nasync function handler(req, res) {\n    if (req.method === 'PUT') {\n        const { id  } = req.query;\n        const body = JSON.parse(req.body);\n        const session = await new _backend_sessions__WEBPACK_IMPORTED_MODULE_0__[\"default\"].timedTask(()=>{\n            return _backend_sessions__WEBPACK_IMPORTED_MODULE_0__[\"default\"].update(id, body.products);\n        }, 5000).start();\n        if (session instanceof Error) return res.status(session.status).json({\n            \"error\": session.message\n        });\n        res.json(session);\n    } else {\n        res.status(400).end();\n    }\n}; // /api/checkout/update/123\n // body: \n // {\n //    \"products\": [\"1\", \"2\", \"3\"]\n //}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWdlcy9hcGkvY2hlY2tvdXQvdXBkYXRlL1tpZF0uanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBbUQ7QUFFcEMsZUFBZUMsT0FBTyxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRSxDQUFDO0lBQzdDLEVBQUUsRUFBQ0QsR0FBRyxDQUFDRSxNQUFNLEtBQUssQ0FBSyxNQUFFLENBQUM7UUFDdEIsS0FBSyxDQUFDLENBQUNDLENBQUFBLEVBQUUsR0FBQyxHQUFHSCxHQUFHLENBQUNJLEtBQUs7UUFDdEIsS0FBSyxDQUFDQyxJQUFJLEdBQUdDLElBQUksQ0FBQ0MsS0FBSyxDQUFDUCxHQUFHLENBQUNLLElBQUk7UUFDaEMsS0FBSyxDQUFDRyxPQUFPLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQ1YsbUVBQWtCLEtBQU8sQ0FBQztZQUNoRCxNQUFNLENBQUNBLGdFQUFlLENBQUNLLEVBQUUsRUFBRUUsSUFBSSxDQUFDTSxRQUFRO1FBQzVDLENBQUMsRUFBRSxJQUFJLEVBQUVDLEtBQUs7UUFDZCxFQUFFLEVBQUNKLE9BQU8sWUFBWUssS0FBSyxFQUFFLE1BQU0sQ0FBQ1osR0FBRyxDQUFDYSxNQUFNLENBQUNOLE9BQU8sQ0FBQ00sTUFBTSxFQUFFQyxJQUFJLENBQUMsQ0FBQztZQUFBLENBQU8sUUFBRVAsT0FBTyxDQUFDUSxPQUFPO1FBQUEsQ0FBQztRQUM5RmYsR0FBRyxDQUFDYyxJQUFJLENBQUNQLE9BQU87SUFDcEIsQ0FBQyxNQUFLLENBQUM7UUFDSFAsR0FBRyxDQUFDYSxNQUFNLENBQUMsR0FBRyxFQUFFRyxHQUFHO0lBQ3ZCLENBQUM7QUFDTCxDQUFDLENBRUQsQ0FBMkI7QUFDM0IsQ0FBUztBQUNULENBQUk7QUFDSixDQUFpQztBQUNqQyxDQUFHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2NodWxzaG9wLy4vcGFnZXMvYXBpL2NoZWNrb3V0L3VwZGF0ZS9baWRdLmpzP2UxZDMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNlc3Npb25zIGZyb20gJy4uLy4uLy4uLy4uL2JhY2tlbmQvc2Vzc2lvbnMnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgICBpZihyZXEubWV0aG9kID09PSAnUFVUJykge1xyXG4gICAgICAgIGNvbnN0IHtpZH0gPSByZXEucXVlcnk7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IEpTT04ucGFyc2UocmVxLmJvZHkpO1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBuZXcgc2Vzc2lvbnMudGltZWRUYXNrKCgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25zLnVwZGF0ZShpZCwgYm9keS5wcm9kdWN0cylcclxuICAgICAgICB9LCA1MDAwKS5zdGFydCgpO1xyXG4gICAgICAgIGlmKHNlc3Npb24gaW5zdGFuY2VvZiBFcnJvcikgcmV0dXJuIHJlcy5zdGF0dXMoc2Vzc2lvbi5zdGF0dXMpLmpzb24oe1wiZXJyb3JcIjogc2Vzc2lvbi5tZXNzYWdlfSk7XHJcbiAgICAgICAgcmVzLmpzb24oc2Vzc2lvbilcclxuICAgIH1lbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKDQwMCkuZW5kKClcclxuICAgIH1cclxufVxyXG5cclxuLy8gL2FwaS9jaGVja291dC91cGRhdGUvMTIzXHJcbi8vIGJvZHk6IFxyXG4vLyB7XHJcbi8vICAgIFwicHJvZHVjdHNcIjogW1wiMVwiLCBcIjJcIiwgXCIzXCJdXHJcbi8vfSJdLCJuYW1lcyI6WyJzZXNzaW9ucyIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJpZCIsInF1ZXJ5IiwiYm9keSIsIkpTT04iLCJwYXJzZSIsInNlc3Npb24iLCJ0aW1lZFRhc2siLCJ1cGRhdGUiLCJwcm9kdWN0cyIsInN0YXJ0IiwiRXJyb3IiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./pages/api/checkout/update/[id].js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("./pages/api/checkout/update/[id].js"));
module.exports = __webpack_exports__;

})();